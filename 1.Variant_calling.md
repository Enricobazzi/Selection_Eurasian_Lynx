---
title: "Variant_calling"
author: "Enrico"
date: "16 March 2020"
output: html_document
---

After mapping to the Canada Lynx reference genomes I will proceed to call variants with the software GATK (version 4.1.4.1).

We will not go through a GVCF and will call variants directly to VCF format with Haplotypecaller.

This will be run on the CESGA ft2 server for faster execution, sbatching parallel jobs (1.Variant_calling-executables/per_CHR_Haplotype_caller.sh) for each chromosome.

In order to run the analysis separately for each chromosome I need to generate a BED file for each chromosome with its length, extracting this information from the FAI index file of the reference genome.
```
CHRarray=($(cat /mnt/lustre/scratch/home/csic/ebd/jg2/LL_selection/Ref_Genome_LyCa/lc4.fa.fai | cut -f 1))

for i in ${CHRarray[@]}
  do
  echo $i
  cat /mnt/lustre/scratch/home/csic/ebd/jg2/LL_selection/Ref_Genome_LyCa/lc4.fa.fai |
  grep -w "$i" |
  cut -f1,2 |
  awk 'BEGIN {FS="\t"; OFS="\t"} {print $1, 0, $2}' > \
  /mnt/lustre/scratch/home/csic/ebd/jg2/LL_selection/Ref_Genome_LyCa/CHR_BEDs/${i}_CHR_coordinates.bed
done
```
Now we are ready to sbatch our script for each chromosome
```
CHRarray=($(cat /mnt/lustre/scratch/home/csic/ebd/jg2/LL_selection/Ref_Genome_LyCa/lc4.fa.fai | cut -f 1))
for chr in ${CHRarray[@]}
 do
  echo "calling variants in ${chr}"
  sbatch per_CHR_Haplotype_caller.sh ${chr}
done

calling variants in scaffold_11_arrow_ctg1
Submitted batch job 3793716
calling variants in Super_Scaffold_6
Submitted batch job 3793717
calling variants in Super_Scaffold_7
Submitted batch job 3793718
calling variants in Super_Scaffold_8
Submitted batch job 3793719
calling variants in Super_Scaffold_10
Submitted batch job 3793720
calling variants in scaffold_17_arrow_ctg1_1
Submitted batch job 3793721
calling variants in scaffold_17_arrow_ctg1
Submitted batch job 3793722
calling variants in scaffold_18_arrow_ctg1
Submitted batch job 3793723
calling variants in scaffold_18_arrow_ctg1_1
Submitted batch job 3793724
calling variants in Super_Scaffold_11
Submitted batch job 3793725
calling variants in Super_Scaffold_4
Submitted batch job 3793726
calling variants in Super_Scaffold_5
Submitted batch job 3793727
calling variants in scaffold_21_arrow_ctg1
Submitted batch job 3793728
calling variants in scaffold_26_arrow_ctg1
Submitted batch job 3793729
calling variants in scaffold_2_arrow_ctg1
Submitted batch job 3793730
calling variants in scaffold_35_arrow_ctg1
Submitted batch job 3793731
calling variants in scaffold_36_arrow_ctg1
Submitted batch job 3793732
calling variants in Super_Scaffold_1
Submitted batch job 3793733
calling variants in scaffold_42_arrow_ctg1
Submitted batch job 3793734
calling variants in scaffold_44_arrow_ctg1
Submitted batch job 3793735
calling variants in scaffold_45_arrow_ctg1
Submitted batch job 3793736
calling variants in scaffold_47_arrow_ctg1
Submitted batch job 3793737
calling variants in scaffold_49_arrow_ctg1
Submitted batch job 3793738
calling variants in Super_Scaffold_3
Submitted batch job 3793739
calling variants in scaffold_50_arrow_ctg1
Submitted batch job 3793740
calling variants in scaffold_51_arrow_ctg1
Submitted batch job 3793741
calling variants in scaffold_52_arrow_ctg1
Submitted batch job 3793742
calling variants in scaffold_53_arrow_ctg1
Submitted batch job 3793743
calling variants in scaffold_54_arrow_ctg1
Submitted batch job 3793744
calling variants in scaffold_55_arrow_ctg1
Submitted batch job 3793745
calling variants in scaffold_57_arrow_ctg1
Submitted batch job 3793746
calling variants in scaffold_58_arrow_ctg1
Submitted batch job 3793747
calling variants in scaffold_59_arrow_ctg1
Submitted batch job 3793748
calling variants in Super_Scaffold_2
Submitted batch job 3793749
calling variants in scaffold_61_arrow_ctg1
Submitted batch job 3793750
calling variants in scaffold_62_arrow_ctg1
Submitted batch job 3793751
calling variants in scaffold_63_arrow_ctg1
Submitted batch job 3793752
calling variants in scaffold_64_arrow_ctg1
Submitted batch job 3793753
calling variants in scaffold_65_arrow_ctg1
Submitted batch job 3793754
calling variants in scaffold_66_arrow_ctg1
Submitted batch job 3793755
calling variants in scaffold_67_arrow_ctg1
Submitted batch job 3793756
calling variants in scaffold_68_arrow_ctg1
Submitted batch job 3793757
calling variants in scaffold_69_arrow_ctg1
Submitted batch job 3793758
calling variants in Super_Scaffold_13
Submitted batch job 3793759
calling variants in scaffold_70_arrow_ctg1
Submitted batch job 3793760
calling variants in scaffold_72_arrow_ctg1
Submitted batch job 3793761
calling variants in scaffold_73_arrow_ctg1
Submitted batch job 3793762
calling variants in scaffold_74_arrow_ctg1
Submitted batch job 3793763
calling variants in scaffold_75_arrow_ctg1
Submitted batch job 3793764
calling variants in scaffold_76_arrow_ctg1
Submitted batch job 3793765
calling variants in scaffold_77_arrow_ctg1
Submitted batch job 3793766
calling variants in scaffold_78_arrow_ctg1
Submitted batch job 3793767
calling variants in scaffold_79_arrow_ctg1
Submitted batch job 3793768
calling variants in Super_Scaffold_9
Submitted batch job 3793769
calling variants in scaffold_80_arrow_ctg1
Submitted batch job 3793770
calling variants in scaffold_81_arrow_ctg1
Submitted batch job 3793771
calling variants in scaffold_82_arrow_ctg1
Submitted batch job 3793772
calling variants in scaffold_83_arrow_ctg1
Submitted batch job 3793773
calling variants in scaffold_84_arrow_ctg1
Submitted batch job 3793774
calling variants in scaffold_85_arrow_ctg1
Submitted batch job 3793775
calling variants in scaffold_86_arrow_ctg1
Submitted batch job 3793776
calling variants in scaffold_87_arrow_ctg1
Submitted batch job 3793777
calling variants in scaffold_88_arrow_ctg1
Submitted batch job 3793778
calling variants in scaffold_89_arrow_ctg1
Submitted batch job 3793779
calling variants in Super_Scaffold_12
Submitted batch job 3793780
calling variants in scaffold_90_arrow_ctg1
Submitted batch job 3793781
calling variants in Super_Scaffold_14
Submitted batch job 3793782
```
